name: documentation

on:
  push:
    branches:    
      - 'main'
  repository_dispatch:
    types: [ build_docs ]

jobs:
  build_docs:
    name: ðŸ“š Build documentation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Checkout showdown repo
        uses: actions/checkout@v3
        with:
          repository: showdownjs/showdown
          path: repo
      
      - name: âž• Copy website artifacts
        id: website
        run: |
          rsync -acvh ./ ./public --exclude README.md --exclude repo --delete
      
      - name: ðŸ‘· ðŸ“š Build documentation
        id: build_docs
        working-directory: ./repo
        run: |
          docker run --rm -v ${PWD}:/docs squidfunk/mkdocs-material build
          rsync -acvh ./public/ ../public/docs --delete

      - name: ðŸš€ Deploy to GitHub Pages 
        if: steps.build_docs.outcome == 'success'
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}